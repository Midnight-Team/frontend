<template>
    <div class="es1 bg-white q-mx-sm  rounded-borders shadow-4 relative">
        <div class="title-1 w100 text-h6 row items-center text-primary shadow-1 q-py-xs justify-center text-bold">
            <q-icon size="md" color="primary" name="event" class="q-pr-sm" />
            Informa√ß√µes do Evento
        </div>
        <div class="column q-gutter-y-md q-pa-md q-mb-xl">
            <div class="text-center w100 text-primary text-bold mid-opacity">Preencha as informa√ß√µes necess√°rias para cria√ß√£o do seu evento:</div>
            <q-input filled class="q-mt-lg" v-model="evento.titulo"  label="T√≠tulo*" />
            <q-input filled type="textarea" v-model="evento.descricao" label="Descri√ß√£o" />
            <q-input filled type="textarea" v-model="evento.endereco" label="Endere√ßo*" />
            <q-input filled type="textarea" v-model="evento.contato" label="Contato*" />
            <div class="q-gutter-y-sm column">
                <div class="row items-center text-h6 text-primary justify-center no-wrap q-gutter-x-sm">
                    <q-icon color="primary" size="md" name="schedule" />
                    <div>
                        Hora e Data do Evento
                    </div>
                    <q-icon color="primary" size="md" name="today" />
                </div>
                <div class="row no-wrap q-mr-md">
                    <q-input label="Hora In√≠cio*" class="q-mt-md q-ml-md" style="width: 45%;" outlined
                        v-model="evento.hora_evento" mask="time" :rules="['time']">
                        <template v-slot:append>
                            <q-icon name="access_time" color="primary" class="cursor-pointer">
                                <q-popup-proxy cover transition-show="scale" transition-hide="scale">
                                    <q-time v-model="evento.hora_evento">
                                        <div class="row items-center justify-end">
                                            <q-btn v-close-popup label="Close" color="primary" flat />
                                        </div>
                                    </q-time>
                                </q-popup-proxy>
                            </q-icon>
                        </template>
                    </q-input>
                    <q-input label="Hora Fim" class="q-mt-md q-ml-md" style="width: 45%;" outlined
                        v-model="evento.hora_final" mask="time" :rules="['time']">
                        <template v-slot:append>
                            <q-icon name="access_time" color="primary" class="cursor-pointer">
                                <q-popup-proxy cover transition-show="scale" transition-hide="scale">
                                    <q-time v-model="evento.hora_final">
                                        <div class="row items-center justify-end">
                                            <q-btn v-close-popup label="Close" color="primary" flat />
                                        </div>
                                    </q-time>
                                </q-popup-proxy>
                            </q-icon>
                        </template>
                    </q-input>
                </div>
                <div class="q-mx-md">
                    <q-date class="w100" v-model="evento.data_evento" mask="DD-MM-YYYY HH:mm" color="primary" />
                </div>
            </div>
            <q-select outlined v-model="evento.pacote"  @click="openSelect()"  @update:model-value="checkSaldoToQtdIngressos()" label="Quantidade de Ingressos Inicial*"
            :options="pacoteOptions" />
            <div class="text-primary saldo row items-center">
                <div class="row items-center q-gutter-x-xs">
                    <div>
                        Meu Saldo:
                    </div>
                    <div class="text-bold text-primary q-px-xs">{{authStore.getInfoPurpleCoins()}}</div>
                    <div class="text-bold mid-opacity text-primary">PurpleCoins</div>
                    <q-icon name="paid" size="md" class="q-pr-sm" color="primary" />
                </div>
                <q-btn label="Recarregar PurpleCoins" color="primary" icon-right="currency_exchange" to="/app/recarregar" />
            </div>

            <q-input maxlength="250" placeholder="Insira a url do banner" filled v-model="evento.img_url" label="Link da Imagem do Evento">
                <template v-slot:append>
                    <q-btn flat icon="image" @click="verImg(evento.img_url)" color="primary" />
                </template>
            </q-input>
            <q-input  placeholder="Clique no √≠cone ao lado para ajuda" maxlength="500" filled v-model="evento.localizacao" label="Localiza√ß√£o Google Maps">
                <template v-slot:append>
                    <q-btn flat icon="pin_drop" @click="helpLocGoogle()" color="primary" />
                </template>
            </q-input>
            <div class="w100 hline bg-primary"></div>
            <q-btn :disabled="checkRequiredFields()"  label="pr√≥ximo" color="primary" @click="goNext()" icon-right="skip_next" />
            <q-btn label="meus eventos" flat color="primary" @click="returnEventos()" />
        </div>

    </div>
</template>

<script setup>
import { ref, defineEmits, onMounted } from "vue";
import { useRouter } from "vue-router";
import { useAuthStore } from 'src/stores/authStore';
import { useQuasar } from "quasar";

const authStore = useAuthStore();
const router = useRouter()
const emit = defineEmits(['next', 'prev'])
const $q = useQuasar()

const evento = ref({
    titulo: '',
    descricao: '',
    endereco: '',
    contato: '',
    localizacao: '',
    data_evento: '',
    hora_evento: '',
    hora_final: '',
    pacote: null,
    img_url: '',
})

const goNext = () => {
    evento.value.data_evento = evento.value.data_evento.slice(0, 10)
    sessionStorage.setItem('eventoStep1', JSON.stringify(evento.value))
    emit('next')
}

const returnEventos = () => {
    router.push('/evento')
}

const checkRequiredFields = () => {
    if (evento.value.titulo == '' || evento.value.endereco == '' || evento.value.contato == '' || evento.value.hora_evento == '' || evento.value.data_evento == '' || evento.value.pacote == null) {
        return true
    } else {
        return false
    }
}
const pacoteOptions = [
    { value: 1, label: '0% taxa - 50 ingressos por 1püü£', purpleCoins: 1, max_ingressos: 50, },
    { value: 2, label: '0% taxa - 100 ingressos por 2püü£', purpleCoins: 2, max_ingressos: 100, },
    { value: 3, label: '0% taxa - 300 ingressos por 3püü£', purpleCoins: 3, max_ingressos: 300 },
    { value: 4, label: '0% taxa - 600 ingressos por 5püü£', purpleCoins: 5, max_ingressos: 600 },
    { value: 5, label: '0% taxa - 2000 ingressos por 10püü£', purpleCoins: 10, max_ingressos: 2000 },
    { value: 6, label: '0% taxa - 5000 ingressos por 20püü£', purpleCoins: 20, max_ingressos: 5000 }
]


function verImg(url) {
    window.open(url, '_blank')
}

const helpLocGoogle = () => {
    $q.notify({
        message: 'Para buscar a localiza√ß√£o do seu evento acesse o Google Maps, pesquise o local do seu evento, clique em "Compartilhar" e depois em "Incorporar um mapa". Copie e cole o html(iframe) no campo localiza√ß√£o.',
        color: 'blue-8',
        position: 'top',
        icon: 'pin_drop',
        timeout: 10000
    })
}

function openSelect(){
    $q.notify({
            message: 'püü£ = purpleCoins',
            color: 'primary',
            position: 'top',
            icon: 'paid'
        })
}

const checkSaldoToQtdIngressos = () => {

    if(authStore.getInfoPurpleCoins() < evento.value.pacote.purpleCoins){
        $q.notify({
            message: 'Voc√™ n√£o tem saldo suficiente para essa quantidade de ingressos',
            color: 'negative',
            position: 'top',
            icon: 'savings'
        })
        evento.value.pacote = null
    }
}

onMounted(() => {
    const es1Storage = sessionStorage.getItem('eventoStep1')
    const es1 = JSON.parse(es1Storage)
    if(es1){
        evento.value = es1
    }
    window.scrollTo(0, 0);
})

</script>


<style scoped>


.title-1 {
    position: sticky;
    top: 138px;
    background: #efefef4d;
    backdrop-filter: blur(2px);
    z-index: 1;
}
</style>